

<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>bookbuilderpy.path &#8212; bookbuilderpy 1.9.28 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bizstyle.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/bizstyle.js"></script>
    <link rel="canonical" href="https://thomasweise.github.io/bookbuilderpy/_modules/bookbuilderpy/path.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="/bookbuilderpy/_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">bookbuilderpy 1.9.28 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">bookbuilderpy.path</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for bookbuilderpy.path</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;The base class with the information of a build.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">MULTILINE</span>
<span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="nb">compile</span> <span class="k">as</span> <span class="n">_compile</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Final</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Pattern</span><span class="p">,</span> <span class="n">cast</span>

<span class="kn">from</span> <span class="nn">bookbuilderpy.strings</span> <span class="kn">import</span> <span class="n">enforce_non_empty_str_without_ws</span><span class="p">,</span> <span class="n">regex_sub</span>
<span class="kn">from</span> <span class="nn">bookbuilderpy.types</span> <span class="kn">import</span> <span class="n">type_error</span>


<span class="k">def</span> <span class="nf">_canonicalize_path</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check and canonicalize a path.</span>

<span class="sd">    :param path: the path</span>
<span class="sd">    :return: the canonicalized path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">type_error</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Path must not be empty.&quot;</span><span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">path</span><span class="p">)))))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">type_error</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;canonicalized path&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Canonicalization must yield non-empty string, &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;but returned &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Canonicalization cannot yield &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span>


<div class="viewcode-block" id="copy_pure"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.copy_pure">[docs]</a><span class="k">def</span> <span class="nf">copy_pure</span><span class="p">(</span><span class="n">path_in</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path_out</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Path&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform the internal method to copy a file.</span>

<span class="sd">    :param path_in: the path to the input file</span>
<span class="sd">    :param path_out: the path to the output file</span>
<span class="sd">    :returns: the path to the new file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Path</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">path_out</span><span class="p">)))</span></div>


<div class="viewcode-block" id="move_pure"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.move_pure">[docs]</a><span class="k">def</span> <span class="nf">move_pure</span><span class="p">(</span><span class="n">path_in</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path_out</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Path&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Copy a file.</span>

<span class="sd">    :param path_in: the path to the input file</span>
<span class="sd">    :param path_out: the path to the output file</span>
<span class="sd">    :returns: the path to the new file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">po</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">path_out</span><span class="p">)</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="n">po</span><span class="p">)</span>
    <span class="n">po</span><span class="o">.</span><span class="n">enforce_file</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">po</span></div>


<span class="k">def</span> <span class="nf">_copy_un_gzip</span><span class="p">(</span><span class="n">path_in</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path_out</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Path&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Copy a gzip-compressed file.</span>

<span class="sd">    :param path_in: the path to the input file</span>
<span class="sd">    :param path_out: the path to the output file</span>
<span class="sd">    :returns: the path to the new file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">po</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">path_out</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path_in</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_in</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">po</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_out</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">f_in</span><span class="p">,</span> <span class="n">f_out</span><span class="p">)</span>
    <span class="n">po</span><span class="o">.</span><span class="n">enforce_file</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">po</span>


<span class="c1">#: a pattern used to clean up training white space</span>
<span class="n">_PATTERN_TRAILING_WHITESPACE</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">Pattern</span><span class="p">]</span> <span class="o">=</span> \
    <span class="n">_compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[ \t]+\n&quot;</span><span class="p">,</span> <span class="n">MULTILINE</span><span class="p">)</span>


<span class="c1">#: the UTF-8 encoding</span>
<span class="n">UTF8</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;utf-8-sig&quot;</span>

<span class="c1">#: The list of possible text encodings</span>
<span class="n">__ENCODINGS</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> \
    <span class="p">(((</span><span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF8</span><span class="p">,),</span> <span class="n">UTF8</span><span class="p">),</span>
     <span class="p">((</span><span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF32_LE</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF32_BE</span><span class="p">),</span> <span class="s2">&quot;utf-32&quot;</span><span class="p">),</span>
     <span class="p">((</span><span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF16_LE</span><span class="p">,</span> <span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF16_BE</span><span class="p">),</span> <span class="s2">&quot;utf-16&quot;</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_get_text_encoding</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the text encoding from a BOM if present.</span>

<span class="sd">    Adapted from https://stackoverflow.com/questions/13590749.</span>

<span class="sd">    :param filename: the filename</span>
<span class="sd">    :return: the encoding</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># Read just the first four bytes.</span>
    <span class="k">for</span> <span class="n">boms</span><span class="p">,</span> <span class="n">encoding</span> <span class="ow">in</span> <span class="n">__ENCODINGS</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">bom</span> <span class="ow">in</span> <span class="n">boms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">header</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">bom</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">encoding</span>
    <span class="k">return</span> <span class="n">UTF8</span>


<div class="viewcode-block" id="Path"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path">[docs]</a><span class="k">class</span> <span class="nc">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An immutable representation of a path.&quot;&quot;&quot;</span>

    <span class="c1">#: the common path version of this path, if any</span>
    <span class="n">__common</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="c1">#: the internal state: 0=don&#39;t know, 1=file, 2=dir</span>
    <span class="n">__state</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct the object.</span>

<span class="sd">        :param value: the string value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">_canonicalize_path</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">__common</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">__state</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">ret</span>

<div class="viewcode-block" id="Path.enforce_file"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.enforce_file">[docs]</a>    <span class="k">def</span> <span class="nf">enforce_file</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enforce that a path references an existing file.</span>

<span class="sd">        :raises ValueError:  if `path` does not reference an existing file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__state</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__state</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__state</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path &#39;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&#39; does not identify a file.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Path.enforce_dir"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.enforce_dir">[docs]</a>    <span class="k">def</span> <span class="nf">enforce_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enforce that a path references an existing directory.</span>

<span class="sd">        :raises ValueError:  if `path` does not reference an existing directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__state</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__state</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__state</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path &#39;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&#39; does not identify a directory.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Path.contains"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.contains">[docs]</a>    <span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether another path is contained in this path.</span>

<span class="sd">        :param other: the other path</span>
<span class="sd">        :return: `True` is this path contains the other path, `False` if not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__common</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__common</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonpath</span><span class="p">([</span><span class="bp">self</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__common</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonpath</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">other</span><span class="p">)])</span></div>

<div class="viewcode-block" id="Path.enforce_contains"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.enforce_contains">[docs]</a>    <span class="k">def</span> <span class="nf">enforce_contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raise an exception if this path does not contain the other path.</span>

<span class="sd">        :param other: the other path</span>
<span class="sd">        :raises ValueError: if `other` is not a sub-path of this path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enforce_dir</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path &#39;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&#39; does not contain &#39;</span><span class="si">{</span><span class="n">other</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Path.enforce_neither_contains"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.enforce_neither_contains">[docs]</a>    <span class="k">def</span> <span class="nf">enforce_neither_contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enforce that neither path contains another one.</span>

<span class="sd">        :param other: the other path</span>
<span class="sd">        :raises ValueError: if `other` is contained in this path or vice versa</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__common</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__common</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonpath</span><span class="p">([</span><span class="bp">self</span><span class="p">])</span>
        <span class="n">opath</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="n">joint</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonpath</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">opath</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">joint</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__common</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path &#39;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&#39; contains &#39;</span><span class="si">{</span><span class="n">opath</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opath</span><span class="o">.</span><span class="n">__common</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">opath</span><span class="o">.</span><span class="n">__common</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonpath</span><span class="p">([</span><span class="n">opath</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">joint</span> <span class="o">==</span> <span class="n">opath</span><span class="o">.</span><span class="n">__common</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path &#39;</span><span class="si">{</span><span class="n">opath</span><span class="si">}</span><span class="s2">&#39; contains &#39;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Path.relative_to"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.relative_to">[docs]</a>    <span class="k">def</span> <span class="nf">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute a relative path of this path towards the given base path.</span>

<span class="sd">        :param base_path: the string</span>
<span class="sd">        :return: a relative path</span>
<span class="sd">        :raises ValueError: if this path is not inside `base_path`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opath</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span>
        <span class="n">opath</span><span class="o">.</span><span class="n">enforce_contains</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">enforce_non_empty_str_without_ws</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opath</span><span class="p">))</span></div>

<div class="viewcode-block" id="Path.resolve_inside"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.resolve_inside">[docs]</a>    <span class="k">def</span> <span class="nf">resolve_inside</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relative_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Path&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resolve a relative path to an absolute path inside this path.</span>

<span class="sd">        :param relative_path: the path to resolve</span>
<span class="sd">        :return: the resolved child path</span>
<span class="sd">        :raises ValueError: If the path would resolve to something outside of</span>
<span class="sd">            this path and/or if it is empty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opath</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">enforce_non_empty_str_without_ws</span><span class="p">(</span><span class="n">relative_path</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enforce_contains</span><span class="p">(</span><span class="n">opath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">opath</span></div>

<div class="viewcode-block" id="Path.ensure_file_exists"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.ensure_file_exists">[docs]</a>    <span class="k">def</span> <span class="nf">ensure_file_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Atomically ensure that the file exists and create it otherwise.</span>

<span class="sd">        :return: `True` if the file already existed and</span>
<span class="sd">            `False` if it was newly and atomically created.</span>
<span class="sd">        :raises: ValueError if anything goes wrong during the file creation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">existed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_EXCL</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
            <span class="n">existed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="k">raise</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Error when trying to create file &#39;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enforce_file</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">existed</span></div>

<div class="viewcode-block" id="Path.ensure_dir_exists"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.ensure_dir_exists">[docs]</a>    <span class="k">def</span> <span class="nf">ensure_dir_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make sure that the directory exists, create it otherwise.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="k">raise</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Error when trying to create directory &#39;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enforce_dir</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__open_for_read</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open this file for reading.</span>

<span class="sd">        :return: the file open for reading</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span>  <span class="c1"># noqa</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">_get_text_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>  <span class="c1"># noqa</span>
            <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;strict&quot;</span><span class="p">))</span>  <span class="c1"># noqa</span>

<div class="viewcode-block" id="Path.read_all_list"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.read_all_list">[docs]</a>    <span class="k">def</span> <span class="nf">read_all_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read all the lines in a file.</span>

<span class="sd">        :return: the list of strings of text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enforce_file</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_for_read</span><span class="p">()</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">type_error</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="s2">&quot;ret&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File &#39;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&#39; contains no text.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="Path.read_all_str"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.read_all_str">[docs]</a>    <span class="k">def</span> <span class="nf">read_all_str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a file as a single string.</span>

<span class="sd">        :return: the single string of text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enforce_file</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_for_read</span><span class="p">()</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">type_error</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="s2">&quot;ret&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File &#39;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&#39; contains no text.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    <span class="k">def</span> <span class="nf">__open_for_write</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open the file for writing.</span>

<span class="sd">        :return: the text io wrapper for writing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span>  <span class="c1"># noqa</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;strict&quot;</span><span class="p">))</span>  <span class="c1"># noqa</span>

<div class="viewcode-block" id="Path.write_all"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.write_all">[docs]</a>    <span class="k">def</span> <span class="nf">write_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read all the lines in a file.</span>

<span class="sd">        :param contents: the contents to write</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensure_file_exists</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">type_error</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="s2">&quot;contents&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">))</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__open_for_write</span><span class="p">()</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
            <span class="n">all_text</span> <span class="o">=</span> <span class="n">contents</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> \
                <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_text</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Writing empty text is not permitted.&quot;</span><span class="p">)</span>
            <span class="n">all_text</span> <span class="o">=</span> <span class="n">regex_sub</span><span class="p">(</span><span class="n">_PATTERN_TRAILING_WHITESPACE</span><span class="p">,</span>
                                 <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">all_text</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_text</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Text becomes empty after removing trailing whitespace?&quot;</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">all_text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">all_text</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Path.as_directory"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.as_directory">[docs]</a>    <span class="k">def</span> <span class="nf">as_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Path&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the closest directory along this path.</span>

<span class="sd">        :return: the directory: either this path if it already identifies a</span>
<span class="sd">            directory, or the parent directory if this path identifies a file.</span>
<span class="sd">        :raises ValueError: if no containing directory exists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">base_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base_dir</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">base_dir</span><span class="o">.</span><span class="n">enforce_dir</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">base_dir</span></div>

<div class="viewcode-block" id="Path.resolve_input_file"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.resolve_input_file">[docs]</a>    <span class="k">def</span> <span class="nf">resolve_input_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">relative_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">lang</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Path&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resolve a path to an input file relative to this path.</span>

<span class="sd">        :param relative_path: the relative path to resolve</span>
<span class="sd">        :param lang: the language to use</span>
<span class="sd">        :return: the resolved path</span>
<span class="sd">        :raises ValueError: if the path cannot be resolved to a file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">relative_path</span> <span class="o">=</span> <span class="n">enforce_non_empty_str_without_ws</span><span class="p">(</span><span class="n">relative_path</span><span class="p">)</span>
        <span class="n">lang</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">lang</span> <span class="ow">is</span> <span class="kc">None</span> \
            <span class="k">else</span> <span class="n">enforce_non_empty_str_without_ws</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>

        <span class="n">base_dir</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_directory</span><span class="p">()</span>
        <span class="n">candidate</span><span class="p">:</span> <span class="n">Path</span>

        <span class="k">if</span> <span class="n">lang</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">split_prefix_suffix</span><span class="p">(</span><span class="n">relative_path</span><span class="p">)</span>
            <span class="n">candidate</span> <span class="o">=</span> <span class="n">base_dir</span><span class="o">.</span><span class="n">resolve_inside</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">lang</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">candidate</span><span class="p">):</span>
                <span class="n">candidate</span><span class="o">.</span><span class="n">__state</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="n">candidate</span>
        <span class="n">candidate</span> <span class="o">=</span> <span class="n">base_dir</span><span class="o">.</span><span class="n">resolve_inside</span><span class="p">(</span><span class="n">relative_path</span><span class="p">)</span>
        <span class="n">candidate</span><span class="o">.</span><span class="n">enforce_file</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">candidate</span></div>

<div class="viewcode-block" id="Path.split_prefix_suffix"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.split_prefix_suffix">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">split_prefix_suffix</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                            <span class="n">enforce_suffix</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Split the file name &#39;name&#39; into a prefix and a suffix.</span>

<span class="sd">        :param name: the file name</span>
<span class="sd">        :param enforce_suffix: crash if no suffix?</span>
<span class="sd">        :return: a tuple of [prefix, suffix]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dot</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dot</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dot</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">enforce_suffix</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; does not have suffix?&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">enforce_non_empty_str_without_ws</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># check for stuff such as tar.xz and tar.gz</span>
        <span class="n">dot2</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dot</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">dot2</span> <span class="o">&lt;</span> <span class="n">dot</span> <span class="ow">and</span> <span class="n">name</span><span class="p">[</span><span class="n">dot2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">dot</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;tar&quot;</span><span class="p">:</span>
            <span class="n">dot</span> <span class="o">=</span> <span class="n">dot2</span>
        <span class="k">return</span> <span class="n">enforce_non_empty_str_without_ws</span><span class="p">(</span><span class="n">name</span><span class="p">[:</span><span class="n">dot</span><span class="p">]),</span> \
            <span class="n">enforce_non_empty_str_without_ws</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">dot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span></div>

<div class="viewcode-block" id="Path.path"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.path">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Path&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a canonical path.</span>

<span class="sd">        :param path: the path to canonicalize</span>
<span class="sd">        :return: the `Path` instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">Path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="Path.file"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.file">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">file</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Path&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a path identifying a file.</span>

<span class="sd">        :param path: the path</span>
<span class="sd">        :return: the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fi</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">fi</span><span class="o">.</span><span class="n">enforce_file</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fi</span></div>

<div class="viewcode-block" id="Path.directory"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.directory">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">directory</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Path&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a path identifying a directory.</span>

<span class="sd">        :param path: the path</span>
<span class="sd">        :return: the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fi</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">fi</span><span class="o">.</span><span class="n">enforce_dir</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fi</span></div>

<div class="viewcode-block" id="Path.copy_file"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.copy_file">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">copy_file</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                  <span class="n">dest</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Path&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy one file to another one, doing gz-unzipping if necessary.</span>

<span class="sd">        This method copies a source file to a destination file.</span>
<span class="sd">        If the source file has suffix &quot;svgz&quot; and the destination file has</span>
<span class="sd">        suffix &quot;svg&quot; OR if the source file has suffix &quot;gz&quot; and the destination</span>
<span class="sd">        file has not, then we will unzip the source file to the destination</span>
<span class="sd">        file.</span>
<span class="sd">        Otherwise, a normal copy is performed.</span>

<span class="sd">        :param source: the source file</span>
<span class="sd">        :param dest: the destination file</span>
<span class="sd">        :return: the fully-qualified destination path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source_file</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">dest_file</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">source_file</span> <span class="o">==</span> <span class="n">dest_file</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot copy file &#39;</span><span class="si">{</span><span class="n">dest_file</span><span class="si">}</span><span class="s2">&#39; into itself.&quot;</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">ssuffix</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">split_prefix_suffix</span><span class="p">(</span><span class="n">source_file</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">dsuffix</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">split_prefix_suffix</span><span class="p">(</span><span class="n">dest_file</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">ssuffix</span> <span class="o">==</span> <span class="s2">&quot;svgz&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dsuffix</span> <span class="o">==</span> <span class="s2">&quot;svg&quot;</span><span class="p">))</span> <span class="ow">or</span> \
                <span class="p">((</span><span class="n">ssuffix</span> <span class="o">==</span> <span class="s2">&quot;gz&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dsuffix</span> <span class="o">!=</span> <span class="s2">&quot;gz&quot;</span><span class="p">)):</span>
            <span class="n">copy</span> <span class="o">=</span> <span class="n">_copy_un_gzip</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">copy</span> <span class="o">=</span> <span class="n">copy_pure</span>
        <span class="n">copy</span><span class="p">(</span><span class="n">source_file</span><span class="p">,</span> <span class="n">dest_file</span><span class="p">)</span>
        <span class="n">dest_file</span><span class="o">.</span><span class="n">enforce_file</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dest_file</span></div>

<div class="viewcode-block" id="Path.copy_resource"><a class="viewcode-back" href="../../bookbuilderpy.html#bookbuilderpy.path.Path.copy_resource">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">copy_resource</span><span class="p">(</span><span class="n">source_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                      <span class="n">input_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                      <span class="n">dest_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Path&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy an input file to an destination directory.</span>

<span class="sd">        :param source_dir: the source directory</span>
<span class="sd">        :param input_file: the input file</span>
<span class="sd">        :param dest_dir: the destination directory</span>
<span class="sd">        :return: the path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">in_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">source_dir</span><span class="p">)</span>
        <span class="n">in_dir</span><span class="o">.</span><span class="n">enforce_dir</span><span class="p">()</span>
        <span class="n">in_file</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
        <span class="n">in_file</span><span class="o">.</span><span class="n">enforce_file</span><span class="p">()</span>
        <span class="n">out_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">)</span>
        <span class="n">out_dir</span><span class="o">.</span><span class="n">enforce_dir</span><span class="p">()</span>
        <span class="n">in_dir</span><span class="o">.</span><span class="n">enforce_neither_contains</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>

        <span class="n">rel_path</span> <span class="o">=</span> <span class="n">in_file</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">in_dir</span><span class="p">)</span>
        <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">split_prefix_suffix</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;svgz&quot;</span><span class="p">:</span>
            <span class="n">rel_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">.svg&quot;</span>

        <span class="n">out_path</span> <span class="o">=</span> <span class="n">out_dir</span><span class="o">.</span><span class="n">resolve_inside</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span>
        <span class="n">inner_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">out_path</span><span class="p">))</span>
        <span class="n">out_dir</span><span class="o">.</span><span class="n">enforce_contains</span><span class="p">(</span><span class="n">inner_dir</span><span class="p">)</span>
        <span class="n">inner_dir</span><span class="o">.</span><span class="n">ensure_dir_exists</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Path</span><span class="o">.</span><span class="n">copy_file</span><span class="p">(</span><span class="n">in_file</span><span class="p">,</span> <span class="n">out_path</span><span class="p">)</span></div></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">bookbuilderpy 1.9.28 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">bookbuilderpy.path</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021-2023, Thomas Weise.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.0.1.
    </div>
  </body>
</html>